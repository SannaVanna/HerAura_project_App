{% extends 'base.html' %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">

<div class="main-container grid grid-cols-4 gap-4 p-4">

    <!-- LEFT SIDEBAR -->
    <div class="sidebar">
      <div class="bottom">
        <nav>
          <a href="{{ url_for('dashboard_bp.dashboard') }}" class="active">ğŸ  Dashboard</a>
          <a href="{{ url_for('mentor_bp.mentors_page') }}">ğŸ‘©â€ğŸ« Mentor Connect</a>
          <a href="{{ url_for('community_bp.community_page') }}">ğŸ’¬ Community</a>
          <a href="{{ url_for('learn_bp.learn_skill') }}">ğŸ“ Learn Skills</a>
          <a href="{{ url_for('health_bp.health_tracker') }}">â¤ Health Tracker</a>
          <a href="{{ url_for('ai_bp.ai_chat') }}">ğŸ¤– AI Assistant</a>
          <a href="{{ url_for('todo_bp.todo_list') }}">ğŸ“‹To-Do list</a>
        </nav>
      </div>
    </div>  

  <!-- Community Posts -->
  <section class="col-span-2 shadow rounded-2xl p-6 overflow-y-auto max-h-[85vh]">
    <h2 class="text-2xl font-bold mb-4 text-pink-600">Community Board ğŸ’¬</h2>

    <!-- New Post Form -->
    <div class="welcome-section d-flex align-items-center gap-3 mb-3">
      <img src="{{ url_for('static', filename='profile_images/' + current_user.profile_image) }}" alt="Profile" class="">
      <form action="{{ url_for('community_bp.create_post') }}" method="POST" class="mb-6">
        <textarea name="content" placeholder="What's on your mind..." class="w-full border p-3 rounded-lg"></textarea>
        <button type="submit" class="mt-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">Post</button>
      </form>
    </div>  

    <!-- Posts -->
    {% for post in posts %}
    <div class="post rounded-2xl p-4 mb-4 bg-gray-50">
      <div class="welcome-section2 d-flex align-items-center gap-3 mb-3">
        <img src="{{ url_for('static', filename='profile_images/' + post.user.profile_image) }}" alt="Profile image" class="profile-image">
        <h4 class="font-semibold text-purple-700">{{ post.user.first_name }} {{ post.user.last_name }}</h4>
      </div>

      <p class="mt-2">{{ post.content }}</p>
      {% if current_user.id == post.user.id%}
      <div>
        <a href="{{ url_for('community_bp.edit_post', post_id=post.id) }}" class="btn btn-sm btn-warning">Edit</a>
        <form action="{{ url_for('community_bp.delete_post', post_id=post.id)}}" method="POST" style="display:inline;">
          <button type="submit" class="btn btn-sm btn-danger">Delete</button>
        </form>
      </div>  
      {% endif %}

      <small class=" time text-gray-500">{{ post.created_at.strftime('%b %d, %Y %I:%M %p') if post.created_at else '' }}</small>
      <form action="{{ url_for('community_bp.like_post', post_id=post.id) }}" method="POST" class="inline-block">
        <button class="text-pink-600 font-semibold ml-2">â¤ {{ post.likes | length }}</button>
      </form><!--post section end-->

      <!-- Comments -->
      <div class="mt-3 pl-4 comment-l-2">
        {% for comment in post.comments %}    
        <div class="welcome-section2 d-flex align-items-center gap-3 mb-3">
          <img src="{{ url_for('static', filename='profile_images/' + comment.user.profile_image) }}" alt="Profile image" class="profile-image">
          <p class=" mb-1"><strong>{{ comment.user.first_name }}</strong>: {{ comment.content }}</p>
          <span class="time ml-100">{{ time_ago(comment.created_at) }}</span>    
        </div>
      
        <!--form action="{{ url_for('community_bp.comment_react', comment_id=comment.id) }}" method="POST" class="inline-block">
          <button class="text-pink-60 font-semibold ml-2">â¤ {{ post.likes | length }}</button>
        </form-->
        
        {% endfor %}


        <!-- Add Comment -->
        <form action="{{ url_for('community_bp.add_comment', post_id=post.id) }}" method="POST">
          <input name="content" class="border p-1 text- w-3/4 rounded-lg" placeholder="Write a comment..." />
          <button type="submit" class="text-purple-600 text-sm font-semibold ml-2">Comment</button>
        </form>
      </div>
    </div>
    {% endfor %}
  </section>

  <!-- Right Sidebar -->
  <div class="right-sidebar">
    <div class="top">
      <ul class="online-users">
        <h4>Online</h4>
        {% for u in users %}
        <li class="py-1">
          <img src="{{ url_for('static', filename='profile_images/' + current_user.profile_image) }}" alt="Profile image" class="profile-image">
          <span>{{ u.first_name }} {{ u.last_name }}</span>
          <span class="status-dot"></span>
        </li>  
        {% endfor %}
      </ul>
    </div>
  </div>  
</div>
{% endblock %}